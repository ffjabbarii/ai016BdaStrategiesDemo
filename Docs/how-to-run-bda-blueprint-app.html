<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to Run BDA Blueprint App - Complete Workflow Guide</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .workflow-step {
            background: #1a1a1a;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            color: #ffffff;
        }
        .code-analysis {
            background: #000000;
            border: 2px solid #00ffff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            color: #ffffff;
        }
        .script-breakdown {
            background: #1a1a1a;
            border: 2px solid #ffff00;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #ffffff;
        }
        .ui-section {
            background: #1a1a1a;
            border: 2px solid #ff6600;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            color: #ffffff;
        }
        .port-info {
            background: #2a2a2a;
            border-left: 4px solid #00ff00;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
            color: #ffffff;
        }
        .line-by-line {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #ffffff;
        }
        .command-flow {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .python-flow {
            background: #1a1a1a;
            border: 2px solid #3776ab;
            border-radius: 8px;
            padding: 15px;
            color: #ffffff;
        }
        .csharp-flow {
            background: #1a1a1a;
            border: 2px solid #512bd4;
            border-radius: 8px;
            padding: 15px;
            color: #ffffff;
        }
        
        /* Fix all headings and bold text */
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff !important;
        }
        
        h3 {
            color: #00ffff !important;
            font-weight: bold !important;
            font-size: 20px !important;
        }
        
        strong {
            color: #ffff00 !important;
            font-weight: bold !important;
        }
        
        .workflow-step h3 {
            color: #00ff00 !important;
        }
        
        .ui-section h3 {
            color: #ff6600 !important;
        }
        
        .python-flow h3 {
            color: #3776ab !important;
        }
        
        .csharp-flow h3 {
            color: #512bd4 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üöÄ How to Run BDA Blueprint App</h1>
            <p class="subtitle">Complete Workflow Guide - UI Manager, APIs, and Testing</p>
        </header>

        <main class="main-content">
            <!-- Overview -->
            <section class="card">
                <h2>üéØ Complete Application Workflow</h2>
                
                <div class="ui-section">
                    <h3>üìã Application Components</h3>
                    <ul>
                        <li><strong>UI Manager:</strong> Python GUI for managing the entire system</li>
                        <li><strong>Python API:</strong> FastAPI on port 8000 for BDA processing</li>
                        <li><strong>C# API:</strong> ASP.NET Core on port 5000 for BDA processing</li>
                        <li><strong>Testing Scripts:</strong> Automated build and test validation</li>
                        <li><strong>BDA Project:</strong> test-w2-fixed-1765841521 (shared by both APIs)</li>
                    </ul>
                </div>

                <div class="port-info">
                    <h3>üîå Port Allocation</h3>
                    <ul>
                        <li><strong>Port 8000:</strong> Python Blueprint API (FastAPI)</li>
                        <li><strong>Port 5000:</strong> C# Blueprint API (ASP.NET Core)</li>
                        <li><strong>Port 8001:</strong> Python Textract API (if used)</li>
                        <li><strong>Port 5001:</strong> C# Textract API (if used)</li>
                        <li><strong>Port 8080:</strong> Documentation Portal</li>
                    </ul>
                </div>
            </section>

            <!-- Step 1: UI Manager -->
            <section class="card">
                <h2>1Ô∏è‚É£ Start the UI Manager</h2>
                
                <div class="workflow-step">
                    <h3>üñ•Ô∏è Launch Command</h3>
                    <div class="code-analysis">
                        <pre class="code-block">
python Startup/startup.py
                        </pre>
                    </div>
                </div>

                <div class="script-breakdown">
                    <h3>üìù startup.py - Line by Line Analysis</h3>
                    
                    <div class="line-by-line">
                        <h4>üßπ Port Cleanup Function (Lines 8-65)</h4>
                        <pre class="code-block">
def cleanup_port(port):
    # Line 12: Uses 'lsof' command to find processes using the port
    result = subprocess.run(['lsof', '-ti', f':{port}'])
    
    # Lines 15-20: Extracts process IDs from lsof output
    pids = result.stdout.strip().split('\n')
    
    # Lines 25-30: Graceful termination with SIGTERM
    os.kill(pid, signal.SIGTERM)
    
    # Lines 35-40: Force kill with SIGKILL if needed
    os.kill(pid, signal.SIGKILL)
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Cleans up any processes using BDA ports (8000, 5000, etc.)</p>
                    </div>

                    <div class="line-by-line">
                        <h4>üîÑ Main Cleanup Function (Lines 95-115)</h4>
                        <pre class="code-block">
def cleanup_all_bda_ports():
    # Line 97: Defines all BDA system ports
    bda_ports = [8000, 8001, 8002, 5000, 5001, 5002, 8080]
    
    # Lines 105-110: Loops through each port and cleans it
    for port in bda_ports:
        cleanup_port(port)
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Ensures all BDA ports are free before starting</p>
                    </div>

                    <div class="line-by-line">
                        <h4>üöÄ Main Function (Lines 117-145)</h4>
                        <pre class="code-block">
def main():
    # Line 122: Locates the GUI manager script
    gui_script = startup_dir / "gui_manager.py"
    
    # Line 129: Calls port cleanup
    cleanup_all_bda_ports()
    
    # Line 140: Launches the GUI manager
    subprocess.run([sys.executable, str(gui_script)])
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Orchestrates cleanup and GUI launch</p>
                    </div>
                </div>

                <div class="ui-section">
                    <h3>üñ±Ô∏è UI Manager Actions</h3>
                    <p style="color: #ffffff;">When the GUI opens, you'll see buttons for:</p>
                    <ul>
                        <li><strong>"Start W-2 Processor":</strong> Launches Python API on port 8000</li>
                        <li><strong>"Start C# API":</strong> Launches C# API on port 5000</li>
                        <li><strong>"Run Tests":</strong> Executes validation scripts</li>
                        <li><strong>"View Documentation":</strong> Opens documentation portal</li>
                    </ul>
                </div>
            </section>

            <!-- Step 2: Start Python API -->
            <section class="card">
                <h2>2Ô∏è‚É£ Start Python W-2 Processor</h2>
                
                <div class="workflow-step">
                    <h3>üêç Click "Start W-2 Processor" Button</h3>
                    <p style="color: #ffffff;">This button executes the equivalent of:</p>
                    <div class="code-analysis">
                        <pre class="code-block">
cd python/BlueprintAPI
python3 -m uvicorn src.api:app --host 0.0.0.0 --port 8000 --reload
                        </pre>
                    </div>
                </div>

                <div class="python-flow">
                    <h3>üêç Python API Startup Process</h3>
                    <ul>
                        <li><strong>Line 1:</strong> Changes to Python API directory</li>
                        <li><strong>Line 2:</strong> Starts uvicorn ASGI server</li>
                        <li><strong>--host 0.0.0.0:</strong> Binds to all network interfaces</li>
                        <li><strong>--port 8000:</strong> Uses port 8000 for Python API</li>
                        <li><strong>--reload:</strong> Auto-reloads on code changes</li>
                        <li><strong>src.api:app:</strong> Loads FastAPI app from src/api.py</li>
                    </ul>
                </div>

                <div class="port-info">
                    <h3>üîó Python API Endpoints</h3>
                    <ul>
                        <li><strong>http://localhost:8000/health</strong> - Health check</li>
                        <li><strong>http://localhost:8000/blueprint/projects</strong> - List BDA projects</li>
                        <li><strong>http://localhost:8000/blueprint/project/test-w2-fixed-1765841521/upload</strong> - Upload W-2</li>
                        <li><strong>http://localhost:8000/process/w2</strong> - Direct W-2 processing</li>
                    </ul>
                </div>
            </section>

            <!-- Step 3: Testing Scripts -->
            <section class="card">
                <h2>3Ô∏è‚É£ Run Build and Test Scripts</h2>
                
                <div class="workflow-step">
                    <h3>üß™ Testing Script Sequence</h3>
                    <div class="code-analysis">
                        <pre class="code-block">
# Script 1: Fix and test C# build
python3 fix_and_test_csharp.py

# Script 2: Prove both APIs work
python3 prove_both_work.py
                        </pre>
                    </div>
                </div>

                <div class="script-breakdown">
                    <h3>üìù fix_and_test_csharp.py - Line by Line</h3>
                    
                    <div class="line-by-line">
                        <h4>üßπ Clean Function (Lines 15-25)</h4>
                        <pre class="code-block">
def test_csharp_fix():
    # Line 18: Sets C# project directory
    csharp_dir = "csharp/BlueprintAPI"
    
    # Line 21: Runs dotnet clean command
    subprocess.run(["dotnet", "clean"], cwd=csharp_dir)
    
    # Line 25: Runs dotnet restore command  
    subprocess.run(["dotnet", "restore"], cwd=csharp_dir)
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Cleans and restores C# project dependencies</p>
                    </div>

                    <div class="line-by-line">
                        <h4>üî® Build Function (Lines 35-50)</h4>
                        <pre class="code-block">
    # Line 38: Builds C# project in Release mode
    result = subprocess.run([
        "dotnet", "build", "--configuration", "Release"
    ], cwd=csharp_dir, capture_output=True, text=True)
    
    # Lines 45-50: Checks build result and reports success/failure
    if result.returncode == 0:
        print("‚úÖ C# build SUCCESSFUL!")
        return True
    else:
        print(f"‚ùå Build failed: {result.stderr}")
        return False
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Compiles C# project and validates build success</p>
                    </div>

                    <div class="line-by-line">
                        <h4>üöÄ Runtime Test (Lines 55-85)</h4>
                        <pre class="code-block">
def test_csharp_run():
    # Line 60: Starts C# API process
    process = subprocess.Popen([
        "dotnet", "run", "--configuration", "Release"
    ], cwd=csharp_dir)
    
    # Lines 65-75: Waits for API to respond on port 5000
    for attempt in range(20):
        response = requests.get("http://localhost:5000/health")
        if response.status_code == 200:
            print("‚úÖ C# API started successfully!")
            break
    
    # Line 80: Tests endpoints and stops API
    process.terminate()
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Validates C# API can start and respond to requests</p>
                    </div>
                </div>

                <div class="script-breakdown">
                    <h3>üìù prove_both_work.py - Line by Line</h3>
                    
                    <div class="line-by-line">
                        <h4>üêç Python Verification (Lines 15-25)</h4>
                        <pre class="code-block">
def main():
    # Line 18: Runs Python API verification
    result = subprocess.run(["python3", "verify_python_first.py"])
    
    # Lines 20-25: Checks if Python API test passed
    if result.returncode != 0:
        print("‚ùå PYTHON VERIFICATION FAILED!")
        return False
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Ensures Python API still works (not broken by C# changes)</p>
                    </div>

                    <div class="line-by-line">
                        <h4>üî∑ C# Verification (Lines 30-40)</h4>
                        <pre class="code-block">
    # Line 32: Runs C# API verification  
    result = subprocess.run(["python3", "verify_csharp_build.py"])
    
    # Lines 35-40: Checks if C# API test passed
    if result.returncode != 0:
        print("‚ùå C# VERIFICATION FAILED!")
        return False
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Validates C# API builds and runs correctly</p>
                    </div>

                    <div class="line-by-line">
                        <h4>‚úÖ Final Validation (Lines 45-60)</h4>
                        <pre class="code-block">
    # Lines 47-55: Reports final results
    print("‚úÖ PYTHON API: Working correctly")
    print("‚úÖ C# API: Builds and runs correctly") 
    print("‚úÖ NO CONFLICTS: Both can run independently")
    print("‚úÖ SAME BDA PROJECT: Both use test-w2-fixed-1765841521")
    
    # Line 58: Provides next steps
    print("Next steps:")
    print("- Run: python3 start_both_apis.py")
    print("- Run: python3 quick_dual_api_test.py")
                        </pre>
                        <p style="color: #ffffff;"><strong>Purpose:</strong> Confirms both APIs work without breaking each other</p>
                    </div>
                </div>
            </section>

            <!-- Code Execution Locations -->
            <section class="card">
                <h2>üìç Where Code Runs</h2>
                
                <div class="command-flow">
                    <div class="python-flow">
                        <h3>üêç Python Code Execution</h3>
                        <ul>
                            <li><strong>Directory:</strong> <code>python/BlueprintAPI/</code></li>
                            <li><strong>Main File:</strong> <code>src/api.py</code></li>
                            <li><strong>Processor:</strong> <code>src/blueprint_processor.py</code></li>
                            <li><strong>Port:</strong> 8000</li>
                            <li><strong>Server:</strong> Uvicorn ASGI</li>
                            <li><strong>Framework:</strong> FastAPI</li>
                            <li><strong>Process:</strong> <code>python3 -m uvicorn src.api:app</code></li>
                        </ul>
                    </div>

                    <div class="csharp-flow">
                        <h3>üî∑ C# Code Execution</h3>
                        <ul>
                            <li><strong>Directory:</strong> <code>csharp/BlueprintAPI/</code></li>
                            <li><strong>Main File:</strong> <code>Program.cs</code></li>
                            <li><strong>Controller:</strong> <code>Controllers/DocumentController.cs</code></li>
                            <li><strong>Service:</strong> <code>Services/BlueprintProcessor.cs</code></li>
                            <li><strong>Port:</strong> 5000</li>
                            <li><strong>Server:</strong> Kestrel</li>
                            <li><strong>Framework:</strong> ASP.NET Core 8.0</li>
                            <li><strong>Process:</strong> <code>dotnet run --configuration Release</code></li>
                        </ul>
                    </div>
                </div>

                <div class="port-info">
                    <h3>üîÑ Process Communication</h3>
                    <ul>
                        <li><strong>Both APIs:</strong> Use same BDA project <code>test-w2-fixed-1765841521</code></li>
                        <li><strong>S3 Bucket:</strong> <code>bda-project-storage-a07a2d75b205</code></li>
                        <li><strong>AWS Region:</strong> us-east-1</li>
                        <li><strong>Communication:</strong> Independent HTTP APIs (no direct communication)</li>
                        <li><strong>Data Sharing:</strong> Through shared S3 bucket and BDA project</li>
                    </ul>
                </div>
            </section>

            <!-- Complete Workflow -->
            <section class="card">
                <h2>üîÑ Complete Workflow Summary</h2>
                
                <div class="workflow-step">
                    <h3>üìã Step-by-Step Process</h3>
                    <ol style="color: #ffffff;">
                        <li><strong>Start UI Manager:</strong> <code>python Startup/startup.py</code>
                            <ul>
                                <li>Cleans up ports 8000, 5000, 8001, 5001, 8002, 5002, 8080</li>
                                <li>Launches GUI manager window</li>
                            </ul>
                        </li>
                        <li><strong>Click "Start W-2 Processor":</strong>
                            <ul>
                                <li>Starts Python FastAPI on port 8000</li>
                                <li>Loads BDA project configuration</li>
                                <li>Ready to process W-2 documents</li>
                            </ul>
                        </li>
                        <li><strong>Run C# Build Test:</strong> <code>python3 fix_and_test_csharp.py</code>
                            <ul>
                                <li>Cleans C# project: <code>dotnet clean</code></li>
                                <li>Restores packages: <code>dotnet restore</code></li>
                                <li>Builds project: <code>dotnet build --configuration Release</code></li>
                                <li>Tests startup: <code>dotnet run</code> on port 5000</li>
                                <li>Validates endpoints and stops</li>
                            </ul>
                        </li>
                        <li><strong>Prove Both Work:</strong> <code>python3 prove_both_work.py</code>
                            <ul>
                                <li>Verifies Python API still works</li>
                                <li>Verifies C# API builds and runs</li>
                                <li>Confirms no conflicts between APIs</li>
                                <li>Validates both use same BDA project</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="ui-section">
                    <h3>üéØ Expected Results</h3>
                    <ul>
                        <li><strong>‚úÖ UI Manager:</strong> Opens successfully, ports cleaned</li>
                        <li><strong>‚úÖ Python API:</strong> Starts on port 8000, responds to health checks</li>
                        <li><strong>‚úÖ C# Build:</strong> Compiles successfully with .NET 8.0</li>
                        <li><strong>‚úÖ C# Runtime:</strong> Starts on port 5000, responds to requests</li>
                        <li><strong>‚úÖ Both APIs:</strong> Can access BDA project independently</li>
                        <li><strong>‚úÖ No Conflicts:</strong> Both can run simultaneously on different ports</li>
                    </ul>
                </div>

                <div class="workflow-step">
                    <h3>üöÄ Ready for Production</h3>
                    <p style="color: #ffffff;">After successful testing, you can:</p>
                    <ul>
                        <li><strong>Run Both APIs:</strong> <code>python3 start_both_apis.py</code></li>
                        <li><strong>Quick Test:</strong> <code>python3 quick_dual_api_test.py</code></li>
                        <li><strong>Production Test:</strong> <code>python3 production_readiness_test.py</code></li>
                        <li><strong>Upload W-2s:</strong> Use either API to process documents</li>
                    </ul>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>üìö Part of the BDA Blueprint Documentation Suite</p>
            <p><a href="index.html">‚Üê Back to Documentation Home</a></p>
        </footer>
    </div>
</body>
</html>